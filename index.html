<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Email Verification</title>

  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link 
    href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" 
    rel="stylesheet"
  />
  <style>
    body { font-family: 'Inter', sans-serif; }
  </style>

  <!-- 1. Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/10.0.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.0.0/firebase-auth-compat.js"></script>
</head>

<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">
  <div 
    id="card" 
    class="bg-white p-8 rounded-xl shadow-lg text-center max-w-sm w-full opacity-0 transition-opacity duration-300"
  >
    <div id="icon" class="text-6xl mb-4"></div>
    <h1 id="title" class="text-3xl font-bold text-gray-800 mb-4"></h1>
    <p id="message" class="text-gray-600 text-lg mb-6"></p>
    <a 
      id="actionBtn" 
      href="/" 
      class="hidden inline-block bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded"
    >
      Go to Sign‑In
    </a>
  </div>

  <script>
    // 2. Initialize Firebase
    firebase.initializeApp({
      apiKey:      "AIzaSyAi5DWMZtLbC9XA218_2RdS1jZjF13kUoo",
      authDomain:  "mabskie-47c24.firebaseapp.com",
      projectId:   "mabskie-47c24",
      databaseURL: "https://mabskie-47c24-default-rtdb.firebaseio.com",
    });

    // 3. Grab URL params
    const params  = new URLSearchParams(window.location.search);
    const mode    = params.get('mode');
    const oobCode = params.get('oobCode');

    // 4. Utility to show the card
    function show(status) {
      const card = document.getElementById('card');
      const icon = document.getElementById('icon');
      const title = document.getElementById('title');
      const message = document.getElementById('message');
      const btn = document.getElementById('actionBtn');

      if (status === 'success') {
        icon.innerHTML    = '✅';
        title.textContent = 'EMAIL VERIFIED';
        message.textContent = 'Your email has been successfully verified. You can now sign in!';
        btn.classList.remove('hidden');
      } else {
        icon.innerHTML    = '❌';
        title.textContent = 'VERIFICATION FAILED';
        message.textContent = 'Sorry, that link is invalid or expired.';
      }

      // fade in
      card.style.opacity = 1;
    }

    // 5. Process the action code
    if ((mode === 'verifyEmail' || mode === 'action') && oobCode) {
      firebase.auth()
        .applyActionCode(oobCode)
        .then(() => show('success'))
        .catch((err) => {
          console.error('applyActionCode error', err);
          show('error');
        });
    } else {
      show('error');
    }
  </script>
</body>
</html>
